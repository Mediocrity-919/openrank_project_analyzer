# GitHub项目深度分析器

- [GitHub项目深度分析器](#github项目深度分析器)
  - [1 项目概述](#1-项目概述)
  - [2 功能描述](#2-功能描述)
    - [2.1 数据分析预测](#21-数据分析预测)
    - [2.2 多个项目对比](#22-多个项目对比)
  - [3 分析过程](#3-分析过程)
    - [3.1 项目分层原理](#31-项目分层原理)
    - [3.2 趋势预测原理](#32-趋势预测原理)
    - [3.3 健康评估原理](#33-健康评估原理)
  - [4 输出呈现](#4-输出呈现)
  - [5 注意事项](#5-注意事项)
    - [5.1 内置 Python 运行](#51-内置-python-运行)
    - [5.2 GitHub API 访问限制](#52-github-api-访问限制)
  - [6 附录](#6-附录)
    - [6.1 动量得分](#61-动量得分)
    - [6.2 阻力得分](#62-阻力得分)
    - [6.3 潜力得分](#63-潜力得分)
    - [6.4 风险得分](#64-风险得分)

## 1 项目概述

**GitHub项目深度分析器**是一个用于对GitHub项目进行综合评估和预测的工具，它结合了多种机器学习算法和数据分析技术，提供了项目的**层级分类**、**趋势预测**、**健康评估**等功能。该工具旨在帮助用户更好地了解GitHub项目的发展状况和潜力，为投资决策、社区管理等提供有力支持。

- **编程语言**：Python, JavaScript
- **主要技术**：Prophet, AHP, GMM, Flask, React
- **数据来源**：GitHub API, OpenDigger API

## 2 功能描述

### 2.1 数据分析预测

**GitHub项目深度分析器**允许您传入**一个或多个Github仓库地址**，根据您的输入自动获取对应仓库的各项指标数据，并对其进行评估分析，以及对其发展趋势做出预测，最终将结果以图表、TXT等格式输出。

- 支持的指标：openrank、activity、stars、attention、participants、contributors等。
- 预测的范围：openrank、stars、attention指标未来6个月的变化趋势。

// TO DO 展示图片

### 2.2 多个项目对比

在**数据分析**功能的基础上，**GitHub项目深度分析器**允许您传入**两个及以上的Github仓库地址**，根据您的输入自动获取对应仓库的各项指标数据，对其进行评估分析后将其与其它项目的各项指标进行对比，最终将结果以图表、TXT等格式输出。

// TO DO 展示图片

## 3 分析过程

**GitHub项目深度分析器**将通过以下几个步骤对您的项目进行深入分析。

1. **项目分层**：
   基于平均**OpenRank**、**总Stars数**、**最大贡献者数**三个指标，使用GMM模型进行概率化分层，将项目分为**GIANT**、**MATURE**、**GROWING**、**EMERGING**四个层级，从而提供更准确的项目画像。
2. **趋势预测**：
   基于**简化版Prophet算法**，结合多种预测方法的加权组合对项目进行预测，提供6个月的趋势预测和置信区间。
3. **健康评估**：
   使用**AHP层次分析法**，从**动量**、**稳定性**、**潜力**、**安全性**4个维度进行分析，并根据项目层级动态调整权重，提供更精准的健康评分。

### 3.1 项目分层原理

分层模型采用**高斯混合模型（GMM）**，通过对项目的历史数据进行聚类分析，将项目划分为不同的层级类别。具体原理如下：

- 分层指标
    GMM分层基于以下三个核心指标：
    1. **平均OpenRank**：项目在分析期间的平均OpenRank值
    2. **总Stars数**：项目获得的总Stars数量
    3. **最大贡献者数**：项目在分析期间的最大贡献者数量
- 层级类别
    项目分析器会把项目分为四个层级：

    | 层级 | 名称 | 描述 | 基准值 |
    | ---- | ---- | ---- | ------ |
    | GIANT | 巨型项目 | 具有极高影响力的大型项目 | OpenRank≥80，Stars≥50000，参与者≥500 |
    | MATURE | 成熟项目 | 发展稳定的成熟项目 | OpenRank≥25，Stars≥5000，参与者≥100 |
    | GROWING | 成长项目 | 快速发展的成长型项目 | OpenRank≥8，Stars≥1000，参与者≥30 |
    | EMERGING | 新兴项目 | 刚刚起步的新兴项目 | OpenRank≥2，Stars≥100，参与者≥5 |

- 概率计算
  对于每个项目，GMM模型会计算其属于四个层级的概率分布：

  1. 将项目的三个指标值标准化
  2. 使用GMM模型的概率密度函数计算项目属于每个组件的概率
  3. 将GMM组件映射到层级标签（按OpenRank中心点排序）
  4. 确定主要层级和置信度（最大概率值）

### 3.2 趋势预测原理

- 预测流程
  1. **数据检测**：检查数据质量和长度，至少需要6个月的数据
  2. **多方法预测**：使用三种预测方法分别进行预测
  3. **加权组合**：按照预设权重组合三种预测结果
  4. **置信区间计算**：基于历史数据的波动性计算预测置信区间
  5. **置信度评估**：基于历史数据的波动性评估预测置信度
  6. **对比验证**：验证预测结果：与GitHub API数据的对比
- 预测方法
    项目分析器结合了三种不同的预测方法，通过加权组合得到最终的预测结果：

    | 预测方法 | 权重 | 适用场景 | 实现原理 |
    | ------- | ---- | ------- | ------- |
    | 线性回归 | 0.4 | 趋势稳定的数据 | 基于最小二乘法拟合线性模型 |
    | 指数回归 | 0.3 | 指数增长或衰减的数据 | 对数据取对数后进行线性回归，再转换回指数形式 |
    | 加权移动平均 | 0.3 | 短期预测，近期数据更重要 | 近期数据权重更高，计算加权平均值 |

### 3.3 健康评估原理

AHP（层次分析法）是一种多准则决策方法，它将复杂问题分解为多个层次和因素，通过比较判断确定各因素的相对重要性，最终得到综合评估结果。

- **评估维度**
  AHP健康评估基于四个核心维度：
  1. **动量**：项目的发展动力，基于PR合并率、贡献者增长、PR加速度
  2. **稳定性**：项目的稳定程度，基于技术债、熵增、Issue压力
  3. **潜力**：项目的增长潜力，基于增长天花板和剩余空间
  4. **安全性**：项目的安全状况，基于风险得分
- **动态权重**
  项目分析器根据项目的层级动态调整各维度的权重：
  
  | 层级 | 动量 | 稳定性 | 潜力 | 安全性 |
  | ---- | ---- | ------ | ---- | ------ |
  | GIANT | 0.25 | 0.35 | 0.15 | 0.25 |
  | MATURE | 0.20 | 0.40 | 0.20 | 0.20 |
  | GROWING | 0.35 | 0.25 | 0.30 | 0.10 |
  | EMERGING | 0.30 | 0.20 | 0.40 | 0.10 |

- **调整因子**
  除了动态权重外，项目分析器还引入了两个调整因子：
  1. **活力状态调整因子**：
     - THRIVING：1.2
     - STABLE：1.0
     - DORMANT：0.8
     - ZOMBIE：0.6
     - UNKNOWN：0.9
  2. **预测置信度调整因子**：
     - 公式：0.9 + 置信度 × 0.2
     - 范围：0.9-1.1
- **计算流程**
  健康值的计算流程如下：
  1. **计算各维度原始分数**：
     - **动量**：[动量得分](#61-动量得分)
     - **稳定性**：100 - [阻力得分](#62-阻力得分)
     - **潜力**：[潜力得分](#63-潜力得分)
     - **安全性**：max(0, 100 - [风险得分](#64-风险得分)×2)
  2. **计算基础健康分**：
    各维度原始分 × 层级权重 的加权平均值
  3. **应用调整因子**：
     - 基础健康分 × 活力状态调整因子 × 预测置信度调整因子
  4. **确定健康等级**：
     - A+：≥85
     - A：≥75
     - B+：≥65
     - B：≥55
     - C：≥45
     - D：≥35
     - F：<35

## 4 输出呈现

分析结果将以多种形式呈现，方便用户理解和使用：

- **图表展示**：使用折线图、柱状图等形式展示各项指标的历史趋势和预测结果。
  // TO DO 展示图片
- **文本报告**：生成详细的TXT报告，包含各项指标的数值、分析结论和建议。
  // TO DO 展示图片

## 5 注意事项

### 5.1 内置 Python 运行

为方便在未安装系统 Python 的环境运行，本项目提供自动引导的便携式 Python 运行：

- 首次运行时，双击或在终端执行 [`run.bat`](./run.bat)，脚本会自动下载并解压 Windows 官方**嵌入式 Python**到 `python_runtime/`，并安装项目依赖（可能耗时较长）。
- 后端服务通过 [`.env`](./backend/.env) 里的 `PYTHON_PATH` 指向内置解释器，无需系统级 Python。

**注意事项：**

- 依赖中包含 `prophet`，在 Windows 上安装可能较慢或需要额外的构建工具；如遇安装困难，可先移除 [`requirements.txt`](./python/scripts/requirements.txt) 中的 `prophet`，功能会有部分受限。

**手动初始化：**：（可选，因为直接运行 [`run.bat`](./run.bat) 会自动初始化）

- 命令行执行以下命令自动安装便携式 Python 与依赖。
  
  ```powershell
    PowerShell -ExecutionPolicy Bypass -File .\scripts\setup_python_runtime.ps1
  ```

- 然后运行 [`run.bat`](./run.bat) 启动服务即可。

### 5.2 GitHub API 访问限制

由于 GitHub 对未认证的 API 访问有较低的速率限制（每小时60次请求），建议在高频使用场景下配置 GitHub 个人访问令牌（PAT）以提升访问速率。

1. 生成 TOKEN：登录 GitHub 账号，访问[Settings -> Developer Settings -> Personal access tokens](https://github.com/settings/tokens)，生成一个新的`Personal access tokens (classic)`，勾选所需权限（通常只需 `repo` 权限）。
2. 复制生成的 TOKEN，妥善保存。（这些TOKEN只在生成时可见，如果没复制就彻底没了）
3. 配置 TOKEN：（任选其一）
  在环境变量中添加 `GITHUB_TOKEN`，值为刚刚复制的个人访问令牌。
  在 [`.env`](./backend/.env) 文件中添加：`GITHUB_TOKEN=你的个人访问令牌`。

## 6 附录

### 6.1 动量得分

**动量得分**基于三个指标：

 1. **质量动量**：
    - 计算最近6个月PR合并率的线性回归得到趋势
    - 公式：50 + 趋势 × 100
 2. **贡献者引力**：
    - 增长：最近6个月贡献者数量的平均增长
    - 留存：1 - 不活跃贡献者比率
    - 公式：50 + 增长 × 10 + 留存 × 30
 3. **PR加速度**：
    - 计算最近6个月PR合并数的二阶差分平均值得到加速度
    - 公式：50 + 加速度 × 20
  
**动量得分** = 质量动量×0.4 + 贡献者引力×0.35 + PR加速度×0.25

### 6.2 阻力得分

**阻力得分**基于三个指标：

  1. **技术阻力**：
     - 计算最近6个月未解决Issue的线性回归得到趋势
     - 公式：30 + 趋势 × 5
  2. **熵增趋势**：
     - 计算最近12个月活跃度的变异系数
     - 公式：波动性 × 50
  3. **Issue压力**：
     - 最近6个月Issue平均新增量 / 历史平均新增量
     - 公式：比率 × 40

**阻力得分** = 技术阻力×0.4 + 熵增趋势×0.3 + Issue压力×0.3

### 6.3 潜力得分

**潜力计算器**采用更悲观的增长潜力估计：

  1. **增长天花板估计**：
     - 方法1：历史最高值的1.5倍
     - 方法2：最近12个月的线性回归外推6个月
     - 取两种方法的最小值作为天花板
  2. **剩余空间**：
     - 公式：((天花板 - 当前值) / (天花板 + 0.1)) × 100
     - 基于层级调整：
     - GIANT：×0.2
     - MATURE：×0.3
     - GROWING：×0.6
     - EMERGING：×0.8

**潜力得分** = 剩余空间

### 6.4 风险得分

风险分析函数 [analyze_risk](./python/v4.py/) 通过活跃度趋势下降、技术债压力和项目活力状态三方面累加风险分，并将其映射为直观的风险等级与告警信息。
